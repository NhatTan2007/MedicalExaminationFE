<h2>Thông tin chi tiết bệnh nhân</h2>
<form *ngIf="$customer | async" [formGroup] = "formModify" (ngSubmit)="updateCustomerInfo()">
    <div class="form-row">
        <div class="form-group col-6 pl-0">
            <label for="#lastName">Họ</label>
            <input  [class.is-invalid]="(isError('lastName') && isTouched('lastName'))
                    || (isError('lastName') && showErrors)"
                    type="text" class="form-control" 
                    formControlName="lastName"
                    #lastName>
            <div class="invalid-feedback d-block"
            *ngIf="(isError('lastName') && isTouched('lastName'))
            || (showErrors && isError('lastName'))">Họ của bệnh nhân không được để trống</div>
        </div>
        <div class="form-group col-6 pr-0">
            <label for="#firstName">Tên</label>
            <input  [class.is-invalid]="(isError('firstName') && isTouched('firstName'))
                    || (isError('firstName') && showErrors)"
                    type="text" class="form-control" 
                    formControlName="firstName"
                    #firstName>
            <div class="invalid-feedback d-block"
            *ngIf="(isError('firstName') && isTouched('firstName'))
            || (showErrors && isError('firstName'))">Tên của bệnh nhân không được để trống</div>
        </div>
    </div>
    <div class="form-row">
        <div class="form-group col-3 pl-0">
            <label for="#gender" class="mr-2 w-100" >Giới tính:</label>
            <mat-radio-group 
                class="example-radio-group"
                formControlName="gender" #gender>
                <mat-radio-button class="mr-2" value=1 [checked]="this.customer.gender">
                    Nam
                </mat-radio-button>
                <mat-radio-button value=0 [checked]="!this.customer.gender">
                    Nữ
                </mat-radio-button>
            </mat-radio-group>
            <div class="invalid-feedback d-block" *ngIf="showErrors && isError('gender')">Xin mời chọn giới tính</div>
        </div>
        <div class="form-group col-3">
            <label for="#dateOfBirth" class="control-label p-0" >Ngày sinh</label>
            <input [class.is-invalid]="(isError('dateOfBirth') && isTouched('dateOfBirth'))
                    || (isError('dateOfBirth') && showErrors)"
                    #dateOfBirth 
                    class="form-control" 
                    formControlName="dateOfBirth" 
                    type="date">
            <div class="invalid-feedback d-block" *ngIf="(showErrors && isError('dateOfBirth'))
            || isError('dateOfBirth') && isTouched('dateOfBirth')">Xin mời nhập ngày sinh</div>

        </div>   
        <div class="form-group col-6 pr-0">
            <label for="#identityNumber">Số CMND/Hộ chiếu</label>
            <input  [class.is-invalid]="(isError('identityNumber') && isTouched('identityNumber'))
                    || (isError('identityNumber') && showErrors)"
                    type="text" class="form-control" 
                    formControlName="identityNumber"
                    (input)="$event.target.value = $event.target.value.toUpperCase()"
                    #identityNumber>
            <div class="invalid-feedback d-block"
            *ngIf="(isError('identityNumber') && isTouched('identityNumber'))
            || (showErrors && isError('identityNumber'))">Số CMND/Hộ chiếu không được để trống</div>

        </div>
    </div>
    <div class="form-row">
        <div class="form-group col-3 pl-0">
            <label for="#dateOfIssuanceIdentityNumber">Cấp ngày</label>
            <input  [class.is-invalid]="(isError('dateOfIssuanceIdentityNumber') && isTouched('dateOfIssuanceIdentityNumber'))
                    || (isError('dateOfIssuanceIdentityNumber') && showErrors)"
                    type="date" class="form-control" 
                    formControlName="dateOfIssuanceIdentityNumber"
                    #dateOfIssuanceIdentityNumber>
            <div class="invalid-feedback d-block"
            *ngIf="(isError('dateOfIssuanceIdentityNumber') && isTouched('dateOfIssuanceIdentityNumber'))
            || (showErrors && isError('dateOfIssuanceIdentityNumber'))">Xin mời nhập ngày cấp CMND/Hộ chiếu</div>
        </div>
        <div class="form-group col-5">
            <label for="#placeOfIssuanceIdentityNumber">Nơi cấp</label>
            <input  [class.is-invalid]="(isError('placeOfIssuanceIdentityNumber') && isTouched('placeOfIssuanceIdentityNumber'))
                    || (isError('placeOfIssuanceIdentityNumber') && showErrors)"
                    type="text" class="form-control" 
                    formControlName="placeOfIssuanceIdentityNumber"
                    #placeOfIssuanceIdentityNumber>
            <div class="invalid-feedback d-block"
            *ngIf="(isError('placeOfIssuanceIdentityNumber') && isTouched('placeOfIssuanceIdentityNumber'))
            || (showErrors && isError('placeOfIssuanceIdentityNumber'))">Xin mời nhập nơi cấp CMND/Hộ chiếu</div>
        </div>
        <div class="form-group col-4 pr-0">
            <label for="#phoneNumber">Điện thoại</label>
            <input  [class.is-invalid]="(isError('phoneNumber') && isTouched('phoneNumber'))
                    || (isError('phoneNumber') && showErrors)"
                    type="text" class="form-control" 
                    formControlName="phoneNumber"
                    #phoneNumber>
            <div *ngIf="(hasError('phoneNumber', 'required') && isTouched('phoneNumber'))
                || (showErrors && hasError('phoneNumber', 'required'))"
                class="invalid-feedback d-block">Điện thoại của bệnh nhân không được để trống</div>
            <div *ngIf="(hasError('phoneNumber', 'minlength') && isTouched('phoneNumber'))
                || (showErrors && hasError('phoneNumber', 'minlength'))"
                class="invalid-feedback d-block">Số điện thoại tối thiểu là 10 số</div>
            <div *ngIf="(hasError('phoneNumber', 'pattern') && isTouched('phoneNumber'))
                || (showErrors && hasError('phoneNumber', 'pattern'))"
                class="invalid-feedback d-block">Số điện thoại bắt đầu bằng số 0</div>
                    
        </div>
    </div>
    <div class="form-group form-row">
        <label for="#address">Địa chỉ</label>
        <input  [class.is-invalid]="(isError('address') && isTouched('address'))
                || (isError('address') && showErrors)"
                type="text" class="form-control" 
                formControlName="address"
                #address>
        <div class="invalid-feedback d-block"
        *ngIf="(isError('address') && isTouched('address'))
            || (showErrors && isError('address'))">Địa chỉ của bệnh nhân không được để trống</div>
    </div>
    <div class="d-flex form-row mt-2">
        <a  class="btn btn-primary"          
            (click)="openUpdate()"
            *ngIf="!update">Chỉnh sửa</a>
        <button class="btn btn-primary" type="submit"
                *ngIf="update">Xác nhận</button>
        <a class="btn btn-warning ml-2"
        (click)="back()"
        *ngIf="update">Trở Lại</a>
        </div>
</form>
<div class="mt-2 form-row bg-light" style="border-radius: 5px;" *ngIf="listMedicalRecord != null">
    <div class="col-3 p-0">
        <h2 class="text-center">Đợt khám bệnh</h2>
        <p *ngFor="let mRecord of listMedicalRecord"
            class="text-center p-2"
            style="border-radius: 5px;"
            [class.selected]="medicalRecord.medicalRecordId == mRecord.medicalRecordId">
            <a class="text-decoration-none d-block" (click)="getMedicalRecord(mRecord.medicalRecordId)" href="javascript:;"
                [class.text-white]="medicalRecord.medicalRecordId == mRecord.medicalRecordId">
                {{mRecord.createDate | date :'dd/MM/yyyy'}}
            </a>
        </p>
    </div>
    <div class="col-9 fomr-group"
        *ngIf="listServicesRegisted.length > 0">
        <h2 class="text-center">Dịch vụ đăng ký</h2>
        <table class="table table-bordered m-0">
            <tbody>
                <tr *ngFor="let service of listServicesRegisted">
                    <td>{{service.mServiceName}}</td>
                    <td class="text-right">{{service.price | mask: 'separator':'.'}} VNĐ</td>
                </tr>
            </tbody>
            <tfoot>
                <tr class="font-weight-bold">
                    <td class="text-center">Tổng tiền</td>
                    <td class="text-right">{{totalAmount | mask: 'separator':'.'}} VNĐ</td>
                </tr>
            </tfoot>
        </table>
    </div>
</div>


<ngx-spinner
	fullScreen = false
	color = "#fff"
	type = "ball-clip-rotate">
</ngx-spinner>